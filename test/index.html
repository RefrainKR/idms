<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>그래프 시각화 (수치 표시 포함)</title>
    <!-- Chart.js 및 Datalabels 플러그인 로드 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background: #f4f7f6; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; margin-bottom: 10px; }
        p { text-align: center; color: #666; margin-bottom: 30px; }
        .chart-box { position: relative; height: 350px; margin-bottom: 50px; }
    </style>
</head>
<body>

<div class="container">
    <h2>1. 픽업 캐릭터 총 획득 수 (중복 포함)</h2>
    <p>막대 위에 구체적인 확률(%)이 표시됩니다.</p>
    <div class="chart-box">
        <canvas id="totalCountChart"></canvas>
    </div>

    <hr style="margin: 40px 0; border: 0; border-top: 1px solid #eee;">

    <h2>2. 특정 최애캐 1명 획득 수</h2>
    <div class="chart-box">
        <canvas id="specificCountChart"></canvas>
    </div>
</div>

<script>
    // 플러그인 등록
    Chart.register(ChartDataLabels);

    // --- 1. 총 획득 수 ---
    const ctxTotal = document.getElementById('totalCountChart').getContext('2d');
    new Chart(ctxTotal, {
        type: 'bar',
        data: {
            labels: ['0장', '1장', '2장', '3장', '4장', '5장', '6장', '7장', '8장+'],
            datasets: [
                {
                    type: 'line',
                    label: '누적 확률',
                    data: [100, 95, 80, 60, 40, 25, 15, 8, 4],
                    borderColor: '#ff6384',
                    borderWidth: 2,
                    borderDash: [5, 5],
                    yAxisID: 'y1',
                    tension: 0.3,
                    pointRadius: 0,
                    // 선 그래프에는 라벨을 숨김 (복잡해지므로)
                    datalabels: { display: false } 
                },
                {
                    type: 'bar',
                    label: '개별 확률',
                    data: [5, 15, 20, 25, 15, 10, 5, 3, 2],
                    backgroundColor: (context) => {
                        return context.dataIndex === 3 ? 'rgba(54, 162, 235, 0.8)' : 'rgba(54, 162, 235, 0.3)';
                    },
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1,
                    yAxisID: 'y'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: { top: 30 } // 상단에 글자가 잘리지 않도록 여백 확보
            },
            plugins: {
                legend: { position: 'bottom' },
                // [핵심] 데이터 라벨 설정
                datalabels: {
                    color: '#444', // 글자색 (진한 회색)
                    anchor: 'end', // 막대 끝 기준
                    align: 'top',  // 막대 위쪽으로 밀기
                    offset: 4,     // 막대와 글자 사이 간격
                    font: { weight: 'bold', size: 12 },
                    formatter: (value) => {
                        // 값이 너무 작으면 표시 안 함 (선택사항)
                        if (value < 1) return null; 
                        return value + '%';
                    }
                }
            },
            scales: {
                y: { display: false, title: { display: true, text: '확률 (%)' } }, // Y축 눈금 숨김 (깔끔하게)
                y1: { display: false, position: 'right', min: 0, max: 110 }
            }
        }
    });

    // --- 2. 특정 캐릭터 획득 수 ---
    const ctxSpecific = document.getElementById('specificCountChart').getContext('2d');
    new Chart(ctxSpecific, {
        type: 'bar',
        data: {
            labels: ['미획득', '명함', '1돌', '2돌', '3돌', '풀돌'],
            datasets: [{
                label: '확률',
                data: [30, 25, 20, 15, 7, 3],
                backgroundColor: [
                    '#e0e0e0', '#ffcd56', 'rgba(75, 192, 192, 0.6)', 
                    'rgba(75, 192, 192, 0.6)', 'rgba(75, 192, 192, 0.6)', '#ff6384'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: { padding: { top: 25 } },
            plugins: {
                legend: { display: false },
                // [핵심] 데이터 라벨 설정
                datalabels: {
                    color: '#333',
                    anchor: 'end',
                    align: 'top',
                    font: { weight: 'bold' },
                    formatter: (value) => value + '%'
                }
            },
            scales: {
                y: { display: false, beginAtZero: true }
            }
        }
    });
</script>

</body>
</html>